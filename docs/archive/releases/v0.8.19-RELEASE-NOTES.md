# v0.8.19 Release Notes
**Date**: October 3, 2025  
**Focus**: Universal Command Support & API Consistency

---

## Summary

This release makes `ls` and `stat` commands universal across all 5 storage backends (S3, GCS, Azure, File, DirectIO) in both CLI and Python API. Adds regex pattern filtering, improves output formatting, and deprecates the S3-only `list` command.

**Status**: ✅ **READY FOR RELEASE**
- CLI: All fixes implemented and tested on 5 backends
- Python API: All fixes implemented and tested on 5 backends
- Build: Zero warnings
- Tests: All passing

---

## Changes

### CLI Improvements

#### 1. Universal `ls` Command with Regex Filtering
- **Added**: `--pattern` (`-p`) flag for regex filtering
- **Works**: All 5 backends (S3, GCS, Azure, File, DirectIO)
- **Implementation**: Client-side filtering after fetching results

```bash
# Filter .txt files universally
s3-cli ls s3://bucket/data/ -p '.*\.txt$'
s3-cli ls gs://bucket/data/ -p '.*\.txt$'
s3-cli ls az://account/container/ -p '.*\.txt$'
s3-cli ls file:///data/ -p '.*\.txt$'
```

#### 2. Universal `stat` Command
- **Changed**: From S3-only to universal using `ObjectStore::stat()`
- **Works**: All 5 backends
- **Improved**: Cleaner output - only shows fields with values (no "None" clutter)

**Before**:
```
Size            : 6
Content-Type    : Some("text/plain")
StorageClass    : None
VersionId       : None
SSE             : Some("AES256")
SSE-KMS Key ID  : None
```

**After**:
```
Size            : 6
Content-Type    : text/plain
SSE             : AES256
```

#### 3. Deprecated `list` Command
- **Added**: Deprecation warning pointing users to `ls`
- **Removal**: Planned for v0.9.0
- **Reason**: Superseded by universal `ls` command

---

### Python API Improvements

#### 1. Universal `list()` Function with Pattern Support
- **Changed**: From S3-only to universal using `ObjectStore::list()`
- **Added**: Optional `pattern` parameter for regex filtering
- **Works**: All 5 backends

```python
# Before (S3 only)
s3dlio.list("s3://bucket/")  # ✅ Works
s3dlio.list("gs://bucket/")  # ❌ Error

# After (Universal)
s3dlio.list("s3://bucket/")              # ✅ Works
s3dlio.list("gs://bucket/")              # ✅ Works
s3dlio.list("az://account/container/")   # ✅ Works
s3dlio.list("file:///data/")             # ✅ Works

# With pattern filtering
s3dlio.list("s3://bucket/", pattern=r'.*\.txt$')  # ✅ Works on all backends
```

#### 2. Universal `stat()` Function
- **Changed**: From S3-only to universal using `ObjectStore::stat()`
- **Works**: All 5 backends
- **Consistent**: Same clean output format as CLI

```python
# Before (S3 only, Azure/GCS failed)
s3dlio.stat("s3://bucket/key")  # ✅ Works
s3dlio.stat("gs://bucket/key")  # ❌ Error

# After (Universal)
s3dlio.stat("s3://bucket/key")           # ✅ Works
s3dlio.stat("gs://bucket/key")           # ✅ Works
s3dlio.stat("az://account/cont/key")     # ✅ Works
s3dlio.stat("file:///path/file")         # ✅ Works
```

---

## Testing

### CLI Testing
- ✅ S3 (signal65-public bucket)
- ✅ GCS (gs://signal65-russ-b1/)
- ✅ Azure (az://egiazurestore1/s3dlio/)
- ✅ File (file:///tmp/s3dlio-test/)
- ✅ DirectIO (direct:///tmp/directio-test/)

**Test Scripts**:
- `scripts/test_v0819_fixes.sh` - S3 and File
- `scripts/test_gcs_v0819_fixes.sh` - GCS
- `scripts/test_azure_v0819_fixes.sh` - Azure
- `scripts/test_directio_v0819_fixes.sh` - DirectIO

### Python API Testing
- ✅ All 5 backends tested with `python/tests/test_v0819_python_api.py`
- ✅ PyO3 extension rebuilt and installed
- ✅ All tests passing

---

## Important Clarifications

### `get` vs `download` (Not Changed)
These serve **different purposes** and are both essential:

- **`get`**: Loads objects into **MEMORY** for AI/ML processing
  - Use case: PyTorch DataLoader, JAX pipelines
  - No disk writes
  - Currently S3-only (universal support planned for future)

- **`download`**: Saves objects to **DISK**
  - Use case: File management, copying to local filesystem
  - Creates local files
  - Already universal

---

## Breaking Changes

**None** - All changes are backward compatible:
- Existing S3-specific code continues to work
- New functionality is additive (pattern parameter is optional)
- Deprecated commands still work (with warning)

---

## Migration Guide

### From `list` to `ls`
```bash
# Old (deprecated)
s3-cli list s3://bucket/prefix/

# New (universal)
s3-cli ls s3://bucket/prefix/
```

### Adding Pattern Filtering
```bash
# CLI
s3-cli ls s3://bucket/data/ -p '.*\.npz$'

# Python
keys = s3dlio.list("s3://bucket/data/", pattern=r'.*\.npz$')
```

---

## Files Modified

### Source Code
- `src/bin/cli.rs`: Universal ls/stat, improved output, deprecation warning
- `src/python_api/python_core_api.rs`: Universal list/stat functions

### Test Infrastructure (New)
- `scripts/test_v0819_fixes.sh`
- `scripts/test_gcs_v0819_fixes.sh`
- `scripts/test_azure_v0819_fixes.sh`
- `scripts/test_directio_v0819_fixes.sh`
- `python/tests/test_v0819_python_api.py`

---

## Future Work (Not in This Release)

- Make CLI `get` command universal (currently S3-only)
- Remote-to-remote copy (e.g., s3:// → gs://)
- Server-side regex filtering where supported

---

## Build Information

**Rust Version**: 1.x  
**Dependencies**: No new dependencies  
**Warnings**: Zero compilation warnings  
**Performance**: No performance regressions (client-side filtering is minimal overhead)

---

**Ready to merge!** ✅
